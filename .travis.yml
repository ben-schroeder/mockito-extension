language: java
os: linux
dist: bionic

env:
  global:
  - secure: M/GQ/SgQCT6VGlPiHuKHSX9l3HoD1XHA7BU5/10piMzymeadZucuoIlhgg0byW1yzs9mgy2N9GIKx7KJqcENrwUfbOuF9CnHwtFMueQ0A1koPumQFEEavYIUI3+akS6pUUap4eHcA2wfa7phiII1hINyl1mT9pvrpU+VLf40vr+guapWhyDKf6AvdnmTBu1DegG1/sj9jbOXlw4zZvRm2HQ00SzoDFS2DSu90mwucvo7DAL3XuT+vhvFw4OZY4XtONQdDMj80WG0veZg2AdOG0TrxUqiMFXBEwCPGsHVBzpjVvJjLPAGTW6hxP3YORFbqBb1TNm/r7URpKKLpFdLL7X3UDohNqAV6T2xN8A6tChDHMa0ALPPIhOW8+bk5KkU2Vsl2krrbOYwyEEIQj5ybAMUmQlWwQjjFPLEd84FyPu4UNhnSoBBy9fIBsOZsI/Ztxo7ox0r+wrZ/pFryWrweZNgdVHynouaxulm0DUf3SJWYK9acgCpxDusY8Ruz8xXWuhe2uhPGvQn+Ntej9x8apaWEI0lFkF6pbJHuAxeOkKuKkvdFwQe52nfjJ1umX7LHoX+ZkJwI9wmoRQqXBG6jRuH0uH7TAHuYPDZMoLj5QzcRrtlZdWKTmi9WziZuglU1UIm7YLFfjrZh3oWJ9xvM18WhlewSfQb0vxetCXAFyY=
  - secure: AHv5mFngzTNpa+/OBMPPD/1C3sdBjwTf0Eq+P09SAECVRDE8fSEcm6I+xwnzqndSWEbQ6xk3exMES568mk2uTfT4Yldkcpw3e6izbfg2sP1hxbrSEa6eVnHDS/9gUAJijLmw0GqiWB0DhegPEhmXa9wrJUZG88vfKA/RFZ23tYvdm20+8y0BAErdPOgOT0wLJs3s0vxIolr8wBHZoaa9zUHoqVFqkojkVqW6LkkHrcLcfnrPOMH4aa0kz6H5lXr/f5+6wYcIfYmbSPNpEuI8XcRrL6Ozf0eHAa8g/uxxY0sklVL6m3VxT9b/X2iz7IcxHIAZvA9UYOSKMwULAA2jMLRWPcHJEAa9mBsqDK7JqPA0m34iXyiTZPT+MOKL6z7vnWCEtLIe7FfUbiVQFXbHlJw0Z70AjEsjUf6+R9G7BTkq5oOp9zne4NCrt3HfnQ3r72zPPW8esUikZaZw0PtgyqkuFSK5PLIWgwWob+A/2oLjlE6uY3mxX0sKMbwSecDjSYOWAQiRfF3zh2DgJk0kpis50JFsuKgcBtOEVFQ7QvdzZ8PwLlr4muc/H+TZG1HHT1990r9y2VAsi7AuqRr74u/uF+FTYsLz6qfEP7QO7QASPPGDA6C27emCMt+FL9Y2ZWaW6jTR8JrNlN9xmhhnRskQ6XMImxvoDWG6Td0KGxY=
  - secure: JGClBl9nxi7AhyRf4c1ENpFurrLkBlovqEnngxc00ug4V7VFNmbUh9GqGd47mdjoa0aP2WY8nI7l9dl1qCobt3tnGBxrUJ04c2MgvcOHR7QuLljCgeHJzrs3wo7cxT0txIGFt7w63wZtOBho4cwd6CT1mXPqqV0bArd0CU2YwoSjrS1AW/Lu423D9mRg+XvIuxbKJqDTrf9SUU8yzVUlvYrA/6Ynk/Laz8ypIUk/XcN3siqVFqoLtyFeGHQeb696K2/eqozIr9bfaFRTaSmZzTWQeQdEiwe1AOfX823YeQcoukaS5ESwH37DaRiwIXJbbJRJvLAx4VnngyNxXsolB8T7m0i8Klw4CzkIIGjOTpHKAfagsePURv6Se4R+4grIbED/gZMZuhC24/QkwvrSNY64zHSipf2CY0GnNELq+ch2pyY9jFKDMu/UeUC2OgyiFl2H3zeVxNU0Bihoa+lsXePYNNaTfBFHs2vpTz42sImonFMxKuIbyDgBRXkkY2YyIouqyy5bsSoe8E5q0148aodolVeCtXM5A0agikFBEYfk1HTo2a80L4BySw+cIyprYxphUlQjRdb3hoO1LOIR6mcBvyEZ5Psp+64mfCzMw9efy167vB4j73ouh7eCDO62ed0cAPlQMn2PsyRfvRB9xf2c7aFvY7ZU58YJXaKzTOs=

cache:
  directories:
  - "$HOME/.m2"

jobs:
  include:
  - stage: build only
    if: branch != master AND tag IS blank
    before_install:
    - mvn clean dependency:go-offline --settings .maven.xml
    install:
    - mvn install --settings .maven.xml
  - stage: build AND use tag version AND deploy release
    if: tag IS present
    before_script:
    - mvn clean dependency:go-offline --settings .maven.xml
    - mvn versions:set -DgenerateBackupPoms=false -DnewVersion=$TRAVIS_TAG --settings .maven.xml
    - openssl aes-256-cbc -K $encrypted_07c4f5e54f27_key -iv $encrypted_07c4f5e54f27_iv
      -in deployment/signingkey.asc.enc -out deployment/signingkey.asc -d
    - gpg2 --keyring=$TRAVIS_BUILD_DIR/pubring.gpg --no-default-keyring --batch --import
      deployment/signingkey.asc
    - gpg2 --allow-secret-key-import --keyring=$TRAVIS_BUILD_DIR/secring.gpg --no-default-keyring
      --batch --import deployment/signingkey.asc
    script:
    - mvn deploy --settings .maven.xml -Prelease -Dgpg.executable=gpg2 -Dgpg.keyname=E137DC17A85F039B
      -Dgpg.publicKeyring=$TRAVIS_BUILD_DIR/pubring.gpg -Dgpg.secretKeyring=$TRAVIS_BUILD_DIR/secring.gpg
      -Dgpg.passphrase=$PASSPHRASE
  - stage: build AND deploy snapshot
    if: branch = master
    before_script:
    - openssl aes-256-cbc -K $encrypted_07c4f5e54f27_key -iv $encrypted_07c4f5e54f27_iv
      -in deployment/signingkey.asc.enc -out deployment/signingkey.asc -d
    - gpg2 --keyring=$TRAVIS_BUILD_DIR/pubring.gpg --no-default-keyring --batch --import
      deployment/signingkey.asc
    - gpg2 --allow-secret-key-import --keyring=$TRAVIS_BUILD_DIR/secring.gpg --no-default-keyring
      --batch --import deployment/signingkey.asc
    script:
    - mvn deploy --settings .maven.xml -Prelease -Dgpg.executable=gpg2 -Dgpg.keyname=E137DC17A85F039B
      -Dgpg.publicKeyring=$TRAVIS_BUILD_DIR/pubring.gpg -Dgpg.secretKeyring=$TRAVIS_BUILD_DIR/secring.gpg
      -Dgpg.passphrase=$PASSPHRASE
